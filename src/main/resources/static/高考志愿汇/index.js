/*! wanmeizhiyuan 2019-07-09 */

define(["jquery","pin","page/head","common/pinData","widget/scoreIndex","widget/score","common/getFlash","ui/tpl"],function($,pin,headjs,pinData,ScoreIndexUi,ScoreUi,getFlash,TPL){function showScoreUi(){var holder=$("#inputScoreForm"),myScore=getCfg("myScore"),callback=function(){document.cookie="changeScoreAtHomepage=1",isLogin?location.href="/zhiyuan?showType=sch":ipinAuth.loginBox()},beforeSubmit=function(){return!!isLogin||(ipinAuth.loginBox(),!1)};if(ScoreIndexUi.init(holder,myScore,{callback:callback,beforeSubmit:beforeSubmit}),myScore.realScore>0&&($(".m-chance-test .test-input").eq(0).val(myScore.realScore).attr("disabled",!0),$(".inschool").val(""),"32"===myScore.prov)){var opt_courseCfg=myScore.opt_courseCfg,req_courseCfg=myScore.req_courseCfg;$("#js_course").text(req_courseCfg.text+myScore.req_level+"/"+opt_courseCfg[myScore.opt_course]+myScore.opt_level)}var ScoreUiCallBack=function(){document.cookie="changeScoreAtHomepage=1",location.reload(),$(".m-chance-test .test-input").eq(0).val(myScore.realScore).attr("disabled",!0)};$(document.body).on("click",".js-changeScore",function(){return ScoreUi(myScore,ScoreUiCallBack).show(!0),$("#scoreInputWrap .m-title").text("模拟高考志愿填报"),!1})}function bannerSwitch(){function autoSlide(){$("#banner_img>li").size()<2||(curIndex+1>=$("#banner_img>li").size()&&(curIndex=-1),show(curIndex+1))}function show(index){$("#banner_ctr>a").removeClass("ctr_btn").eq(index).addClass("ctr_btn"),$("#banner_img>li").eq(curIndex).stop(!1,!0).fadeOut(time),setTimeout(function(){$("#banner_img>li").eq(index).stop(!1,!0).fadeIn(time)},200),curIndex=index,adEventView(curIndex)}function adEventView(curIndex){var adHolder=$("#banner"),adHolderRect=adHolder[0].getBoundingClientRect();if(!(adHolderRect.bottom<adHolderRect.height/2)){var ad=$("#banner_img>li").eq(curIndex).find("a"),adId=ad.data("id"),adPos=ad.data("pos"),report=ad.data("report"),isConvert=ad.data("isconvert"),isValidate=ad.data("isvalidate");report&&ad.length&&adId&&pin.util.sendBehaviorData({target:"index-banner-ads-view",event_category:"ads",extra:{id:adId,position:adPos,type:"view",isConvert:isConvert,isValidate:isValidate}})}}function adEventClick(){$("#banner_img>li").on("click","a",function(){var ad=$(this),adId=ad.data("id"),adPos=ad.data("pos"),report=ad.data("report"),isConvert=ad.data("isconvert"),isValidate=ad.data("isvalidate");report&&ad.length&&adId&&pin.util.sendBehaviorData({target:"index-banner-ads-click",event_category:"ads",extra:{id:adId,position:adPos,type:"click",isConvert:isConvert,isValidate:isValidate}})})}var curIndex=0,time=800,slideTime=4e3,tid=setInterval(autoSlide,slideTime);adEventClick(curIndex),adEventView(curIndex),$("#banner_img>li").on("mouseenter",function(){window.clearInterval(tid)}).on("mouseleave",function(){tid=setInterval(autoSlide,slideTime)}),$("#banner_ctr>a").click(function(){show($(this).index()),window.clearInterval(tid),tid=setInterval(autoSlide,slideTime)})}function showNumbers(){var runTime=1e3,changeTime=50;-1!=document.cookie.indexOf("changeScoreAtHomepage=1")&&(document.cookie="changeScoreAtHomepage=''",ga("send","pageview","/home_score_input"),PageData.uid<=0&&ipinAuth.loginBox(),$("#commendAndFollowSheet .commond-num .num").each(function(){var node=$(this),num=node.data("num"),delta=parseInt(num/(runTime/changeTime))||1,i=0,t=1*new Date,timer=setInterval(function(){i+=delta,(i>=num||1*new Date-t>=runTime)&&(i=num,clearInterval(timer)),node.text(i)},changeTime)}))}function setToolItemWidth(){var items=($(".m-function-list ul").width(),$(".m-function-list ul li"));items.css("width",1/items.length*100+"%")}function followCount(){$(".commond-num").on("click",function(){var li=$(this).closest("li"),type=li.data("type");if(!isLogin){var txtConfig={sch:"登录后即可查看能上的学校",major:"登录后即可查看适合的专业",schmaj:"登录后即可查看推荐的志愿"};return ipinAuth.loginBox("",{legendTxt:txtConfig[type]}),!1}}),$(".m-function-btn").on("click",function(e){var li=$(this).closest("li"),type=li.data("type");if(!isLogin){var txtConfig={sch:"登录后即可查看关注的学校",major:"登录后即可查看关注的专业",schmaj:"登录后即可查看关注的志愿"};return ipinAuth.loginBox("",{legendTxt:txtConfig[type]}),e.preventDefault(),!1}})}function rankHover(){$(".m-ranking-box").on("mouseenter",".m-rank-tab li",function(){if(0!=$(this).siblings().length){var i=$(this).index(),box=$(this).closest(".m-ranking-box"),oLeft=parseInt($(this).css("width"))+20;$(this).addClass("active").siblings("li").removeClass("active"),box.find(".z-link").css("left",oLeft*i+"px"),box.find(".m-table table").eq(i).addClass("active").siblings("table").removeClass("active"),box.find(".rank-head .rank-link").eq(i).removeClass("hidden").siblings(".rank-link").addClass("hidden")}})}function maiDian(){$(".submit-btn-index a").on("click",function(){pin.util.sendBehaviorData({target:"index-zhiyuan-sch"})}),$(".commend-list li a").on("click",function(e){"see-more"===e.currentTarget.className?pin.util.sendBehaviorData({target:"index-commend-list-sch-seemore"}):pin.util.sendBehaviorData({target:"index-commend-list-sch-detail"})}),$(".m-interest-test .m-test-link a").on("click",function(){pin.util.sendBehaviorData({target:"index-test-btn"})}),$(".m-interest-test .m-title-more a").on("click",function(){pin.util.sendBehaviorData({target:"index-see-major-recommend"})}),$(".m-chance-test .go-forecast").on("click",function(){pin.util.sendBehaviorData({target:"index-chance-test-btn"})})}function activityPop(){var hasPop=!1;if($("#layer-mask,.mask").each(function(){if(this.getBoundingClientRect().height)return hasPop=!0,!1}),!(hasPop||cardPrivilege>0)){var activityInfo=pin.getCfg("activityInfo");if(activityInfo){var now=Date.now(),date=(new Date).toISOString().split("T")[0],lastTime=localStorage.getItem("activityInviteTime")||0;if(lastTime&&(lastTime=lastTime.split("_"),lastTime=lastTime[0]!=date?0:lastTime[1]),now>lastTime+216e5){pin.use("richAlert",{alertType:"warn",title:"",content:'<div id="popbg" style="height:158px;"></div>',towBtns:!0,weight:!0,okTxt:"立即领取",okCallback:function(){ga("send","event","专业版限时免费活动","立即领取",{hitCallback:function(){location.href=activityInfo.activity_url}})},cancelTxt:"暂不需要",initUI:function(){this.jq(".win-pop").css({"background-image":"url("+activityInfo.activity_picture+")"}),localStorage.setItem("activityInviteTime",date+"_"+Date.now())}}).display(1)}}}}function domEvents(){$(".m-function-list").on("click",".js-unsurport-zy",function(){pin.use("richAlert",{alertType:"warn",title:"温馨提示",content:"网页版暂不支持职业大全功能，请用手机下载完美志愿APP使用该功能。",towBtns:!0,okTxt:"下载APP体验",okCallback:function(){-1==location.href.indexOf("/download.html")&&(location.href="/download.html")},cancelTxt:"暂不下载"}).display(1)}),$("#m-new-bar").removeClass("hidden"),$(".commend-list .see-more").on("click",function(){if(PageData.uid<=0)return void ipinAuth.loginBox();location.href="/zhiyuan?showType=sch"}),$(".MBTI").on("click",function(){if(PageData.uid<=0)return void ipinAuth.loginBox();var token=$(".MBTI").attr("data-token");location.href="http://ceping.wmzy.com/mbti.html?token="+token+"&source=position"}),$(".HOLLAND").on("click",function(){if(PageData.uid<=0)return void ipinAuth.loginBox();var token=$(".MBTI").attr("data-token");location.href="http://ceping.wmzy.com/holland.html?token="+token+"&source=position"}),VideoTool.init(),bannerSwitch(),showNumbers(),setToolItemWidth(),followCount(),rankHover(),activityPop(),maiDian()}var Req=pin.request,PageData=$.extend({},window.PageData),getCfg=function(name){return PageData[name]},isLogin=getCfg("isLogin"),isVip=getCfg("isVip"),cardPrivilege=getCfg("cardPrivilege"),defaultKey=pin.getCfg("key"),VideoTool={init:function(){$(document.body).on("click",".j-video",function(e){var src=$(this).data("src");return VideoTool.playVideo(src),e.preventDefault(),!1}).on("click",".js-hideVideo",function(e){return VideoTool.hideVideo(),e.preventDefault(),!1})},playVideo:function(src){$(".zm-mask").length?$(".zm-mask").show():$("body").css("position","relative").append($('<div class="zm-mask js-hideVideo" style="position:fixed;left:0;top:0;width:100%;height:100%;z-index:10000;background:rgba(0,0,0,.5)"><i class="zm-closeBtn js-hideVideo" style="position:absolute;font-size:45px;right:100px;top:100px;border-radius:50%;border:1px solid #aaa;width:50px;height:50px;text-align:center;line-height:48px;cursor:pointer;color:#aaa;z-index:1000">×</i><div class="container" style="position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;"></div></div>'));var height=Math.max(400,$(window).innerHeight()-400),width=1.6*height,$container=$(".zm-mask").children(".container");$container.css({width:width+"px",height:height+"px"}),getFlash($container,{src:src,width:width,height:height},{},{allowFullScreen:!0})},hideVideo:function(){var $mask=$(".zm-mask"),$container=$mask.children(".container");$mask.hide(),$container.length&&$container.empty()}},forecast={init:function(){this.initSearchEvent()},score:getCfg("myScore"),$searchBox:$(".por-score .inschool"),$searchBtn:$(".por-score .icon-search"),$dropList:$(".por-score .dropdown-box"),notVip:function(){pin.use("richAlert",{okTxt:"立即升级",alertType:"warn",title:"开通VIP",content:"立即查看中意院校录取概率，更有专业就业前景、防撞车监控等独家功能等你使用",okCallback:function(){window.location.href="/buy/product"}}).display(1)},initSearchEvent:function(){var self=this;self.$searchBox.on("blur",function(){setTimeout(function(){self.hideDropList()},300)}).on("focus",function(){if(self.$dropList.children().length)self.showDropList();else{var val=$.trim(self.$searchBox.val());self.searchSchWidthBatch(val,function(data){self.showResult(data)})}}).keyup(function(e){var val=$.trim(self.$searchBox.val());if("Enter"==e.key||13==e.keyCode){self.$dropList.find("li.hover a").length&&self.fillInput(self.$dropList.find(".hover span"))}else if("ArrowDown"==e.key||40==e.keyCode){var list=self.$dropList.find("li"),highlighter=self.$dropList.find("li.hover"),nextItem=highlighter?list.eq(list.index(highlighter)+1):self.$dropList.find("li").eq(0);self.highlightItem(nextItem,"hover")}else if("ArrowUp"==e.key||38==e.keyCode){var list=self.$dropList.find("li"),highlighter=self.$dropList.find("li.hover"),previousItem=highlighter?list.eq(list.index(highlighter)-1):self.$dropList.find("li").eq(0);self.highlightItem(previousItem,"hover")}else self.searchSchWidthBatch(val,function(data){self.showResult(data)});self.permit()}),self.$dropList.on("mouseenter","li",function(){self.highlightItem($(this),"hover")}).on("click","li",function(event){self.fillInput(self.$dropList.find(".hover span")),self.permit()}),self.$searchBtn.on("click",function(){self.fillInput(self.$dropList.find(".hover span"))}),$(".go-forecast").click(function(event){return PageData.uid<=0?void ipinAuth.loginBox():isVip?!(self.score.realScore<=0)&&void(self.isSchoolExist()&&self.goForecast()):(self.notVip(),!1)}),$(".pro-result").on("mouseenter",".tohover",function(event){$(".float-tips").fadeIn(200)}).on("mouseleave",".tohover",function(event){$(".float-tips").fadeOut(200)}),defaultKey&&self.searchSchWidthBatch(defaultKey,function(data){self.showResult(data),self.$dropList.find("li:first").addClass("hover"),self.fillInput(self.$dropList.find(".hover span")),self.permit()})},permit:function(){var self=this;return"block"==$(".por-score").find(".result-score").css("display")&&self.$searchBox.val()?($(".go-forecast").addClass("permit"),!0):($(".go-forecast").removeClass("permit"),!1)},isSchoolExist:function(){var self=this,schList=self.$dropList.find("span"),match=!1;return self.schInfo={},schList.each(function(i,item){schList.eq(i).text()==self.$searchBox.val()&&(self.schInfo.sch_id=schList.eq(i).data("id"),self.schInfo.diploma=schList.eq(i).data("diploma"),self.schInfo.batch=schList.eq(i).data("batch"),self.schInfo.batchEx=schList.eq(i).data("batchex"),match=!0)}),!match&&alert("你输入的学校不存在喔,请从列表里面选,或者输入学校全称吧"),match},goForecast:function(){var self=this;if("31"==self.score.prov)return alert("因为上海的志愿填报方式较特殊，暂不支录取概率预测。您可以查询感兴趣的学校和专业。"),!1;location.href="/forecast/report?sch_id="+self.schInfo.sch_id+"&batch="+self.schInfo.batch+"&batchEx="+self.schInfo.batchEx},fillInput:function(item){var self=this;self.$searchBox.val($.trim(item.text())).data("id",item.data("id")),self.hideDropList(),self.permit()},showDropList:function(){this.$dropList&&this.$dropList.show()},hideDropList:function(){this.$dropList&&this.$dropList.hide()},highlightItem:function($item,hightlightClass){this.$dropList.find("li").removeClass(hightlightClass),$item.addClass(hightlightClass)},xhr:null,searchSchWidthBatch:function(searchKey,fn){var self=this;return searchKey.length<2?void(0==searchKey.length&&self.hideDropList()):(self.xhr&&self.xhr.abort(),self.xhr=Req.searchSchWidthBatch({searchKey:searchKey},function(resp){fn(resp.data)}),self.xhr)},showResult:function(data){var self=this,schData=data.schData||{sch_list:[]};if(!schData||!schData.sch_list||!schData.sch_list.length)return self.hideDropList(),void self.$dropList.html("");var html=TPL.ejs(self.dropListTpl,schData);self.$dropList.html(html),self.showDropList()},dropListTpl:["<% if(!!data.sch_list && data.sch_list.length){ %>","       <ul>","<%     for(var i=0;i<data.sch_list.length;i++){ %>",'           <li><a href="javascript:;">','               <span data-id="<%=data.sch_list[i].sch_id%>" data-diploma="<%=data.sch_list[i].diploma_id %>"  data-batch="<%=data.sch_list[i].bacth %>" data-batchex="<%=data.sch_list[i].batch_ex %>"><%=data.sch_list[i].sch_name%></span>',"           </a></li>","<%     } %>","       </ul>","<%}%>"].join("")};({init:function(){showScoreUi(),domEvents(),headjs.init()}}).init(),forecast.init()});
//# sourceMappingURL=index.js.map