/*! wanmeizhiyuan 2019-07-09 */

define(["jquery","avalonGetModel"],function($,avalon){var widget=avalon.ui.select=function(element,data,vmodels){var blurHandler,vmodel,innerHTML=['<div class="dropdown" ms-class="active:active">','<a href="#" class="menu-hd" ms-click="show">{{text}}</a>','<ul class="menu-bd">','    <li ms-repeat-el="data"><a href="#" ms-click="selectItem(el,$event)">{{el.text}}</a></li>',"</ul></div>"].join(""),zhiyuan=['<li ms-class="active:active" ms-visible="hideZhuanke" ms-class-1="{{hasset}}" ms-mouseleave="hide">','    <a href="#" ms-mouseenter="show"><i class="more_sj"></i>{{text}}</a>','    <i class="icon" ms-class="{{lock}}" ms-if="lock"></i>','    <div class="menu-bd-box" ms-class="{{otherCss}}">','        <i class="left_line"></i>','        <ul class="menu-bd">','            <li ms-repeat-el="data"><a href="#" ms-click="selectItem(el,$event)">{{el.text}}</a></li>',"        </ul>","    </div>","</li>"].join(""),duplexName=(element.msData["ms-duplex"]||"").trim(),hideSelect=(element.msData["ms-hideselect"]||"").trim();"zhiyuan"==data.selectOptions.$type&&(innerHTML=zhiyuan,data.selectOptions.otherCss=data.selectOptions.otherCss||"");var el=$(innerHTML);$(element).after(el),$(element).remove(),element=el[0],data.element=element,data.selectOptions.text||(data.selectOptions.text=data.selectOptions.value),data.selectOptions.$css&&el.addClass(data.selectOptions.$css);var opt=avalon.mix(!0,{},data.selectOptions);if(opt.data=widget.getSelectData(opt.data),vmodel=avalon.define(data.selectId,function(vm){avalon.mix(!0,vm,opt),vm.active=!1,vm.value="",vm.show=function(e){return vm.active=!vm.active,e&&e.preventDefault&&e.preventDefault(),!1},opt._autoPosition||(vm._autoPosition=function(){var jQEl=el,ulDom=jQEl.find("ul"),cw=document.documentElement.clientWidth||document.body.clientWidth,left=jQEl.left-$(window).scrollLeft(),ulWidth=ulDom.width(),d="";switch(d=left+ulWidth>cw&&left>cw/2?"r":"l",this.lockPosition&&-1!=["r","l"].indexOf(this.lockPosition)&&(d=this.lockPosition),d){case"r":ulDom.css({left:"auto",right:ulDomm.css("marginLeft")});break;case"l":ulDom.css({left:"",right:""})}var ch=document.documentElement.clientHeight||document.body.clientHeight,top=jQEl.offset().top-$(window).scrollTop(),ulHeight=ulDom.height();switch(d=top+ulHeight>ch&&top>ch/2?"t":"b",this.lockPosition&&-1!=["t","b"].indexOf(this.lockPosition)&&(d=this.lockPosition),d){case"t":ulDom.css({top:-ulHeight});break;case"b":ulDom.css({top:""})}}),vm.selectItem=function(el,e){var val=void 0===el.value?el.text:el.value;return!1!==vm.onChange(val)&&(vm.text=el.text,vm.value=val),vm.active=!1,e&&e.preventDefault&&e.preventDefault(),!1},blurHandler=avalon.bind(document.body,"click",function(e){element.contains(e.target)||(vm.active=!1)}),vm.$remove=function(){blurHandler&&avalon.unbind(window,"click",blurHandler)},vm._refresh=function(len){if(vmodel.data.clear(),len>0){vmodel.data.pushArray(widget.getSelectData(vmodel.$source.$model||vmodel.$source));vm._getItem(vm.value)||vm._setFirst()}},vm._setItem=function(val){var item=vm._getItem(val);item?(vm.text=item.text,vm.value=void 0===item.value?item.text:item.value):vm.$mustHaveValue?vm._setFirst():vm._setDef()},vm._setDef=function(){vm.text=vm.$defaultText,vm.value=""},vm._setFirst=function(){var item=vmodel.data[0];item?(item=item.$model,vm.text=item.text,vm.value=void 0===item.value?item.text:item.value):vm._setDef()},vm._getItem=function(val){var item;return(vm.data.$model||vm.data).forEach(function(i){if(i.value===val||void 0===i.value&&i.text===val)return item=i,!1}),item},"zhiyuan"==vm.$type&&(vm.lock=data.selectOptions.lock||!1,vm.hideZhuanke=!0,vm.show=function(e){return vm.active=!0,vm.$fire("all!showSelect",{id:vm.$id}),e&&e.preventDefault&&e.preventDefault(),!1},vm.hide=function(){vm.active=!1},vm._autoPosition=function(){var el=$(element).find(".menu-bd-box"),ch=document.documentElement.clientHeight||document.body.clientHeight;ch-=54,el.css("top",-1);var forTop=el.offset().top-$(window).scrollTop(),thisHeight=el.outerHeight(1);if(ch-forTop<thisHeight){var toHight=thisHeight-ch+forTop;el.css("top",-1*(toHight+1)),el.find(".left_line").css("top",toHight)}else el.css("top",-1),el.find(".left_line").css("top",0)},vm.hasset="filter.batchInfo"==duplexName?"hasset":vm.text!=vm.$defaultText&&vm.text!=vm.data[0].text?"hasset":"")}),vmodel.$source){if("string"===avalon.type(vmodel.$source)){var sourceModel=avalon.getModel(vmodel.$source,vmodels);sourceModel&&(vmodel.$source=sourceModel[1][sourceModel[0]])}else vmodel.$source.$id?vmodel.$source.length>0&&vmodel._refresh(vmodel.$source.length):vmodel.$source=null;vmodel.$source&&vmodel.$source.$watch&&vmodel.$source.$watch("length",function(n){vmodel._refresh(n)})}var duplexModel;if(duplexName&&(duplexModel=avalon.getModel(duplexName,vmodels))&&(duplexModel[1].$watch(duplexModel[0],function(n){vmodel.value=n,vmodel._setItem(vmodel.value)}),vmodel.$watch("value",function(n){duplexModel[1][duplexModel[0]]=n})),"zhiyuan"==data.selectOptions.$type){vmodel.$watch("showSelect",function(e){e.id!=vmodel.$id&&(vmodel.active=!1)}),"filter.batchInfo"!=duplexName&&vmodel.$watch("text",function(text){vmodel.hasset=text!=vmodel.$defaultText&&vmodel.text!=vmodel.data[0].text?"hasset":""});var selectModel;hideSelect&&(selectModel=avalon.getModel(hideSelect,vmodels))&&(selectModel[1].$watch(selectModel[0],function(n){vmodel.hideZhuanke=!n}),vmodel.hideZhuanke=!selectModel[1][hideSelect])}return avalon.nextTick(function(){avalon.scan(element,[vmodel].concat(vmodels))}),vmodel._setItem(data.selectOptions.value),vmodel};return widget.defaults={data:[],value:"",text:"",$defaultText:"NULL",$autoPosition:!0,$mustHaveValue:!1,onChange:avalon.noop},widget.getSelectData=function(data){var t=[];return data.forEach(function(item){avalon.isPlainObject(item)?t.push(item):t.push({text:item})}),t},widget});
//# sourceMappingURL=select.js.map